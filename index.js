import{defineComponent as e,ref as t,inject as i,computed as n,watch as l,openBlock as r,createElementBlock as a,createCommentVNode as s}from"vue";import{useApi as d}from"@directus/extensions-sdk";function o(e,t){return t?function(e,t){const i=new URLSearchParams(e.split("?")[1]||"");for(const[e,n]of Object.entries(t))i.set(e,n);return e.split("?")[0]+"?"+i}(e,{access_token:t}):e}var c=e({props:{value:{type:[String,Object],default:null},fileField:{type:String,default:""},assetsToken:{type:String,default:""}},emits:["input"],setup(e,{emit:r}){const a=d();console.log(a);const s=t(null),c=i("values"),p=t(!1),f=n((()=>s.value&&u?o("video"===u?"":window.location.origin+function(){const e=window.location.pathname.split("/"),t=e.indexOf("admin");return e.slice(0,t).join("/")+"/"}()+`assets/${s.value.id}`,e.assetsToken):null)),u=n((()=>{if(!s.value)return null;let e=s.value.filename_download,t=e.length;return e.indexOf(".mp4")===t-4?"video":e.indexOf(".doc")===t-4||e.indexOf(".docx")===t-5?"doc":e.indexOf(".ppt")===t-4||e.indexOf(".pptx")===t-5?"ppt":e.indexOf(".pdf")===t-4?"pdf":null}));return l((()=>c.value),(t=>{t&&async function(){p.value=!0;try{let t=e.fileField&&c.value[e.fileField]?c.value[e.fileField]:"";if(!t)return;const i=await a.get(`/files/${t}`,{params:{fields:["id","title","width","height","filesize","type","filename_download"]}});s.value=i.data.data}catch(e){console.log(e)}finally{p.value=!1}}()}),{immediate:!0}),{file:s,loading:p,previewFileType:u,src:f}}});const p={class:"file-preview"},f=["src"],u=["src"],v=["src"];var m=[],y=[];!function(e,t){if(e&&"undefined"!=typeof document){var i,n=!0===t.prepend?"prepend":"append",l=!0===t.singleTag,r="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(l){var a=m.indexOf(r);-1===a&&(a=m.push(r)-1,y[a]={}),i=y[a]&&y[a][n]?y[a][n]:y[a][n]=s()}else i=s();65279===e.charCodeAt(0)&&(e=e.substring(1)),i.styleSheet?i.styleSheet.cssText+=e:i.appendChild(document.createTextNode(e))}function s(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var i=Object.keys(t.attributes),l=0;l<i.length;l++)e.setAttribute(i[l],t.attributes[i[l]]);var a="prepend"===n?"afterbegin":"beforeend";return r.insertAdjacentElement(a,e),e}}("\n.file-preview video[data-v-64969d30] {\n  display: block;\n  margin: 0 auto;\n  z-index: 1;\n  width: 100%;\n}\n.file-preview iframe[data-v-64969d30]{\n  width: 100%;\n  min-height: 500px;\n}\n",{}),c.render=function(e,t,i,n,l,d){return r(),a("div",p,[["video"].includes(e.previewFileType)?(r(),a("video",{key:0,controls:"",src:e.src,alt:"",role:"presentation"},null,8,f)):s("v-if",!0),["doc","ppt"].includes(e.previewFileType)?(r(),a("iframe",{key:1,src:`http://view.officeapps.live.com/op/view.aspx?src=${e.src}`,frameborder:"0"},null,8,u)):s("v-if",!0),["pdf"].includes(e.previewFileType)?(r(),a("iframe",{key:2,src:e.src,frameborder:"0"},null,8,v)):s("v-if",!0)])},c.__scopeId="data-v-64969d30",c.__file="src/interface.vue";var g={id:"file-preview",name:"File Preview",description:"Preview single file.",icon:"text_fields",component:c,types:["string"],group:"standard",options:()=>[{field:"fileField",name:"File Field",type:"string",meta:{width:"full",interface:"input",options:{placeholder:"Please enter table height"}}},{field:"assetsToken",name:"Static Access Token",type:"string",meta:{note:"Static access token is appended to the assets' URL",width:"full",interface:"input"}}]};export{g as default};
